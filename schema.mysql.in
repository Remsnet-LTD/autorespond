DROP TABLE IF EXISTS @PREFIX@response, @PREFIX@autoresponder, @PREFIX@log;

CREATE TABLE @PREFIX@autoresponder (
  id INT AUTO_INCREMENT NOT NULL PRIMARY KEY,
  username VARCHAR(128),
  domain VARCHAR(128) NOT NULL,
  response TEXT NOT NULL,
  opt_timelimit INT,
  opt_msglimit INT,
  opt_copymsg BOOL,
  opt_no_inreplyto BOOL,
  opt_subject_prefix TINYTEXT,
  opt_numlines INT,
  opt_headerkeep TINYTEXT,
  opt_headerstrip TINYTEXT,
  opt_separator TINYTEXT
);
CREATE UNIQUE INDEX @PREFIX@autoresponder_skey ON @PREFIX@autoresponder(username,domain);

CREATE TABLE @PREFIX@response (
  autoresponder INT NOT NULL REFERENCES @PREFIX@autoresponder(id),
  timestamp TIMESTAMP NOT NULL,
  sent_response BOOL NOT NULL,
  sender VARCHAR(255) NOT NULL
);
CREATE INDEX @PREFIX@response_pkey ON @PREFIX@response(autoresponder);
CREATE INDEX @PREFIX@response_skey ON @PREFIX@response(sender);

CREATE TABLE @PREFIX@log (
  autoresponder INT NOT NULL REFERENCES @PREFIX@autoresponder(id),
  timestamp TIMESTAMP NOT NULL,
  sent_response BOOL NOT NULL,
  sender VARCHAR(255) NOT NULL
);
